!function(e,t){"use strict";var i={id:"c-tracking",version:2.1,objectPrefix:"tracking-data-",keyPrefix:"data-tracking-",selectors:{sharedData:'script[type="tracking-data"]',parentBlock:"[data-tracking-parent], body",trackingInfo:"[data-tracking]",checkedSelector:'input[type="checkbox"]{0}, input[type="radio"]{0}',checkedAttributeChecked:"data-tracking-checked",checkedAttributeUnChecked:"data-tracking-unchecked",media:"video[data-tracking], audio[data-tracking]"},initialize:function(){this.fullDataType=this.objectPrefix+"digitalData",this.selectors.checkedSelector=this.selectors.checkedSelector.replace(/\{0}/g,this.selectors.trackingInfo),this.selectors.clickElements="a{0}, button{0}".replace(/\{0}/g,this.selectors.trackingInfo),this.selectors.clickElements+=", "+this.selectors.checkedSelector,this.selectors.objectData='script[type^="{0}"]'.replace(/\{0}/g,this.objectPrefix),this.bindListeners()},mergeOptions:function(e,i){if("undefined"!=typeof e&&!t.isArray(e)&&t.isArray(i))return i.push(e),i},isJSON:function(e){return"string"==typeof e&&0!==t.trim(e).length&&(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))},bindListeners:function(){var t=e(document);t.on("c-tracking-log",this.customTrack.bind(this)),t.on("c-tracking-log-dom",this.domTrack.bind(this,"dom")),t.on("c-tracking-log-page",this.pageTrack.bind(this)),t.on("click",this.selectors.clickElements,this.domTrack.bind(this,"click")),document.addEventListener("playing",this.trackMediaState.bind(this),!0),document.addEventListener("ended",this.trackMediaState.bind(this),!0),document.addEventListener("pause",this.trackMediaState.bind(this),!0)},trackMediaState:function(t){var i=t.target,a=e(i),n={eventAction:t.type};a.is(this.selectors.media)&&(n.timePlayed=i.currentTime,n.duration=i.duration,n.type=i.tagName.toLowerCase(),a.trigger("c-tracking-log-dom",n))},elementsToJSON:function(e){var i=this.collectJSONfromElements(e),a={eventInfo:{},digitalData:{}};return i.unshift(a),i.push(this.mergeOptions.bind(this)),a=t.mergeWith.apply(this,i)},collectJSONfromElements:function(i){return t.map(i,function(i){i=e(i);var a,n=i.is("script")?i.html():i.attr("data-tracking"),r={eventInfo:{},digitalData:{}};if(this.isJSON(n)?a=JSON.parse(n):""!==t.trim(n)&&window.trackingDebug&&console.log("Data Layer Warning - Invalid JSON found: \n",n,"\nElement:\n",i),i.is(this.selectors.objectData)){var s={};i.attr("type")===this.fullDataType?s=t.merge({},s,a,this.mergeOptions.bind(this)):s[i.attr("type").replace(new RegExp("^"+this.objectPrefix),"")]=a,r.digitalData=s}else a&&(r.eventInfo=a);for(var o,c,d=i[0],g=d.attributes,l=g.length;l--;)g[l]&&(o=g[l].name,t.startsWith(o,this.keyPrefix)&&!t.includes([this.selectors.checkedAttributeChecked,this.selectors.checkedAttributeUnChecked],o)&&(c=d.getAttribute(o),this.isJSON(c)?r.digitalData[o.replace(new RegExp("^"+this.keyPrefix),"")]=JSON.parse(c):""!==t.trim(c)&&window.trackingDebug&&console.log("Data Layer Warning - Invalid JSON found: \n",c,"\nElement:\n",i,"\nAttribute:\n",o)));return r.digitalData.event&&r.digitalData.event.length&&(r.eventInfo=t.merge({},r.digitalData.event[0],r.eventInfo,this.mergeOptions.bind(this)),delete r.digitalData.event),r}.bind(this))},domTrack:function(i,a,n){var r,s=e(a.target),o=s.closest(this.selectors.parentBlock),c=[],d=n&&e(n.$related);if(n&&delete n.$related,d&&Array.prototype.push.apply(c,d.toArray()),Array.prototype.push.apply(c,o.children(this.selectors.sharedData).toArray()),o.is(this.selectors.trackingInfo)&&Array.prototype.push.apply(c,o.toArray()),Array.prototype.push.apply(c,s.parentsUntil(o).filter(this.selectors.trackingInfo).toArray().reverse()),s.is(this.selectors.trackingInfo)&&(Array.prototype.push.apply(c,s.toArray()),!d)){var g=s.attr("data-tracking");this.isJSON(g)?(g=JSON.parse(g),d=g&&e(g.$related)):""!==t.trim(g)&&window.trackingDebug&&console.log("Data Layer Warning - Invalid JSON found: \n",g,"\nElement:\n",s)}if(r=this.elementsToJSON(c),n&&(n.event?(t.merge(r.eventInfo,n.event[0],this.mergeOptions.bind(this)),delete n.event,t.merge(r.digitalData,n,this.mergeOptions.bind(this))):t.merge(r.eventInfo,n,this.mergeOptions.bind(this))),s.is(this.selectors.checkedSelector)){var l=s.is(":checked")?s.attr(this.selectors.checkedAttributeChecked):s.attr(this.selectors.checkedAttributeUnChecked);this.isJSON(l)?(l=JSON.parse(l),t.merge(r.eventInfo,l,this.mergeOptions.bind(this))):""!==t.trim(l)&&window.trackingDebug&&console.log("Data Layer Warning - Invalid JSON found: \n",l,"\nElement:\n",s,"\nIs Checked:\n",s.is(":checked"))}if("undefined"==typeof r.eventInfo.type&&(r.eventInfo.type=a.type),"undefined"==typeof r.eventInfo.eventName&&(r.eventInfo.eventName=s[0].tagName.toLowerCase()+(s[0].type?"[type='"+s[0].type.toLowerCase()+"'] ":" ")+a.type),"undefined"==typeof r.eventInfo.eventAction){var h="";s.is(this.selectors.checkedSelector)?(h="Name:"+s.attr("name"),h+=", Value:"+s.val(),h+=s.is(":checked")?", :checked":", :unchecked"):h=t.trim(s.text()),r.eventInfo.eventAction=h}"undefined"==typeof r.eventInfo.eventPage&&(r.eventInfo.eventPage=t.get(window,"digitalData.page.pageInfo.pageName")),"undefined"==typeof r.eventInfo.eventMethod&&s.is("audio, video")&&(r.eventInfo.eventMethod=s[0].tagName.toLowerCase()+"-Track"),this.trigger({data:r,$trigger:s,type:i})},pageTrack:function(i,a){var n=i&&i.target?e(i.target).find(this.selectors.objectData):e(this.selectors.objectData),r=this.elementsToJSON(n);t.merge(r,{digitalData:a},this.mergeOptions.bind(this)),this.trigger({data:r,$trigger:e(i&&i.target),type:"page"})},customTrack:function(t,i){this.trigger({data:i,$trigger:e(t.target),type:"custom"})},trigger:function(t){t.$trigger=t.$trigger.length?t.$trigger:e(document);var i=t.$trigger?t.$trigger:e(document);t.data=t.data||{},this.setDataLayer(i,t),window.trackingDebug&&console.log("Data Layer\ndigitalData Object: ",window.digitalData,"\ndigitalData Value:\n",JSON.stringify(window.digitalData,null,2)),i.trigger("c-tracking-trigger",t)},setDataLayer:function(e,i){var a=i.data,n={version:this.version};e.trigger("c-tracking-load-defaults",n),"page"===i.type?window.digitalData=n:window.digitalData=window.digitalData||n,t.merge(window.digitalData,a.digitalData,this.mergeOptions.bind(this)),window.digitalData.event=window.digitalData.event||[],t.size(a.eventInfo)&&window.digitalData.event.push({eventInfo:a.eventInfo})}};i.initialize()}(window.$,window._);